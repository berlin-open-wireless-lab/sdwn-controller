SDWN Controller
===============

[ONOS](http://onospoject.org) application for centralized management of [LEDE](https://lede-project.org/) wifi access points (APs).

## Overview

The SDWN controller is structured into a core controller module exposing an API and service modules using that API. The modules can be built separately using maven. The core controller requires a modified ONOS which includes the SDWN protocol driver. You can find it [here](https://github.com/berlin-open-wireless-lab/sdwn-onos) along with instructions on how to build and run ONOS.
ONOS serves as the SDN platform on top of which the SDWN controller is running.
Actually, the SDWN controller is an ONOS applications on top of ONOS' OpenFlow subsystem. It is a bit confusing at first but the way ONOS is modularized is actually pretty clever and makes developing for the platform easy, once you have understood its structure. Check out the ONOS documentation in their [wiki](https://wiki.onosproject.org/display/ONOS/Wiki+Home) and search for tutorials on YouTube if you want to learn more.

## The SDWN Core

The core is responsible for the communication with and the representation of the network elements (LEDE access points in this case). It uses ONOS' OpenFlow subsystem and the SDWN protocol driver to learn about LEDE switches, their APs, and associated clients. All of this information is stored and made available through a Java API, a REST API, and on the ONOS command-line.

### SDWN Entities

Relevant building blocks of a wireless network are represented by the SDWN controller as so-called _SDWN entities_. These are things such as APs, clients or frequency bands. The SDWN core maintains these entities and makes them accessible through APIs and callback mechanisms.

### Java API

The SDWN controller's Java API is a self-contained module that can be referenced as a dependency in other ONOS applications by adding this to the project's ```pom.xml```:
```xml
<dependency>
    <groupId>de.tuberlin.inet.sdwn</groupId>
    <artifactId>sdwn-core-api</artifactId>
    <version>1.0-SNAPSHOT</version>
</dependency>
```

It contains interfaces and classes for interacting with the SDWN controller or to subscribe to events. There are callback mechanisms to get notifications of the following events:
1. 802.11 management frame (probe/assoc/auth) reception at an AP
2. client association and dis-association
3. the connection or disconnection of a wireless switch

Here is an example of how the Hearingmap service makes use of this interface to track clients:

The hearing map service contains a private class which implements the ```Sdwn80211MgmtFrameListener``` interface:
```java
private final class InternalFrameListener implements Sdwn80211MgmtFrameListener {
    @Override
    public void receivedProbeRequest(MacAddress clientMac, SdwnAccessPoint atAP, long xid, long rssi, long freq) {
        clientHeard(atAP.nic().switchID(), atAP, clientMac, rssi, freq);
    }

    @Override
    public void receivedAuthRequest(MacAddress clientMac, SdwnAccessPoint atAP, long xid, long rssi, long freq) {
        clientHeard(atAP.nic().switchID(), atAP, clientMac, rssi, freq);
    }

    @Override
    public void receivedAssocRequest(MacAddress clientMac, SdwnAccessPoint atAP, long xid, long rssi, long freq) {
        clientHeard(atAP.nic().switchID(), atAP, clientMac, rssi, freq);
    }
}
```
An instance of this class is registered with the SdwnCoreService automatically when the hearing map service is started:
```java
@Activate
public void activate() {
    sdwnService.register80211MgtmFrameListener(frameListener);
    //...
}
```

[This](https://wiki.onosproject.org/display/ONOS/CLI+and+Service+Tutorial) tutorial gives details about how to request the handle to the SdwnController (called ```sdwnService``` in the above example).

### Command-Line Interface

The SDWN controller offers the following commands:
1. ```switches``` - to print information about connected wireless switches
2. ```aps``` - to print information about access points
3. ```clients``` - to print information about clients associated with the access points
4. ```client-remove``` - to sever the association of a client with an access point
5. ```set-channel``` - to instruct an access point to send a channel switch announcement and then change the transmitting channel

Details about the commands' arguments are available from the ONOS shell: ```help sdwn:<command>```.

### REST API

The SDWN controller's REST interface covers the same funcitonality as the command-line interface. It is located at ```<onos_url>/sdwn```. You can find documentation generated by the swagger tool along with interactive test calls at ```<onos_url>/onos/v1/docs```.

## Example Applications

This repository contains two example applications: A simple client hearing map and OpenWifi integration.

### Hearing Map

Located in ```services/hearingmap```, the hearing map service is an independent maven module that makes use of the SDWN controller's API to maintain a map of clients that have been overheard by connected access points. It makes this information available through its own Java API, command-line interface, and REST API.

